#############
### MONZO ###
#############

alias listemulators='~/Library/Android/sdk/emulator/emulator -list-avds'
alias openemulator='~/Library/Android/sdk/emulator/emulator -avd Pixel_8_API_34'
alias emulator='openemulator'

# Monzo Setup
export GOPATH=$HOME
export GOROOT="$(brew --prefix golang)/libexec"
export PATH="$(brew --prefix golang)/bin:$PATH"

export NVM_DIR="$HOME/.nvm"
[ -s "$(brew --prefix)/opt/nvm/nvm.sh" ] && . "$(brew --prefix)/opt/nvm/nvm.sh" # This loads nvm
[ -s "$(brew --prefix)/opt/nvm/etc/bash_completion.d/nvm" ] && . "$(brew --prefix)/opt/nvm/etc/bash_completion.d/nvm" # This loads nvm bash_completion
[ -f ${GOPATH}/src/github.com/monzo/starter-pack/zshrc ] && source $GOPATH/src/github.com/monzo/starter-pack/zshrc

# Android Studio setup
export JAVA_HOME=$(/usr/libexec/java_home -v 21)
export PATH="$PATH:${HOME}/Library/Android/sdk/platform-tools"
# ANDROID_HOME is used by gradle when an sdk path is not specified in another way
export ANDROID_HOME="$HOME/Library/Android/sdk"
export PATH="$ANDROID_HOME/emulator":"$ANDROID_HOME/tools":"$ANDROID_HOME/platform-tools":$PATH
# export ANDROID_HOME="/opt/homebrew/share/android-commandlinetools"
# export ANDROID_SDK_ROOT=$ANDROID_HOME
# export ANDROID_AVD_HOME="${HOME}/.android/avd"
# export PATH="$PATH:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools:${ANDROID_HOME}/tools/bin"

# ex: adblogin mk70ap3k8oadf9cnmvnisoudg@testing.monzo.com
function adblogin() {
    droid deeplink $(Â£ -e s101 "api get /nonprod.test-user-email-log/magic-link recipient_email==\"$1\"" | jq .link -r);
}

eval "$(rbenv init -)"
# Activate Mise
eval "$(mise activate zsh)"

# Added by Toolbox App
export PATH="$PATH:$HOME/Library/Application Support/JetBrains/Toolbox/scripts"

# Created by `pipx` on 2024-06-02 21:39:55
export PATH="$PATH:$HOME/.local/bin"

alias tg='mise x -- tuist generate'
alias ti='mise x -- tuist install'
alias ss="gh pr list -A "@me" -s all | fzf | awk '{print $1}' | xargs shipper deploy --s101"
alias sp="gh pr list -A "@me" -s all | fzf | awk '{print $1}' | xargs shipper deploy --prod"
alias lintwearedev="$GOPATH/bin/lint"

function git-go-test-all-changed-services() {
  local services=`git diff master --name-only  | cut -d'/' -f1 | uniq`
  echo Testing: $services
  echo $services | xargs -I % go test ./%/...
}
alias gt=git-go-test-all-changed-services

function updatexcode() {
  echo "Should be run from ios-app directory"
  LATEST_VALID_XCODE=$(xcodes list | grep -v Beta | grep -v Candidate | grep -v GM | grep -F $TUIST_XCODE_VERSION | tail -n1 | awk '{print $1}')
  echo "Latest valid Xcode version: $LATEST_VALID_XCODE"
  xcodes install "$LATEST_VALID_XCODE" --experimental-unxip
  xcodes select $LATEST_VALID_XCODE
}

rpcmap-all() {
  $XDG_CONFIG_HOME/zsh/rpcmap-all --diff
}